# Сервер Durak

## Переменные окружения

- `FIREBASE_SERVICE_ACCOUNT` — JSON-строка с учётными данными Firebase. Альтернативно можно указать `FIREBASE_SERVICE_ACCOUNT_PATH` с путём к файлу `serviceAccountKey.json`.

## Проверка честности джекпот‑колеса

Результат раунда полностью определяется ставками и `serverSeed`, опубликованным после окончания раунда.

Алгоритм расчёта:

1. Перед раундом сервер генерирует случайный `serverSeed` и публикует его `SHA256`‑хеш.
2. После окончания раунда сервер раскрывает `serverSeed`.
3. Вычисляется псевдослучайное число `R`:

   R = parseInt(sha256(serverSeed).slice(0, 8), 16) / 0xffffffff

4. Суммарный банк `total = red + orange`. Если `R * total < red`, выигрывает «красный», иначе «оранжевый».
5. Пул выплат `payoutPool = total - total * RAKE` распределяется между победившим цветом пропорционально ставкам.

### Пример

    serverSeed = '4'
    red bank = 3 (три игрока по 1)
    orange bank = 7

    sha256(serverSeed) = 4b227777d4dd1fc61c6f884f48641d02b4d121d3fd328cb08b5531fcacdabf8a
    R = 0.2934946695560344
    total = 10 ⇒ R * total = 2.9349 < 3 → побеждает «красный»

    multiplier = payoutPool / red bank = 10 / 3 ≈ 3.3333
    первый игрок получает 3.33
    второй игрок получает 3.33
    третьему добавляется остаток 0.01 → 3.34

Таким образом, любой игрок может самостоятельно пересчитать результат и убедиться в честности раунда.

## Горизонтальное масштабирование

Для масштабируемых деплоев рекомендуется вынести пользовательские сессии и состояние раундов в внешнее хранилище, например Redis или Firestore. Укажите переменную окружения `REDIS_URL` (или используйте сервис Firestore), а конфигурацию деплоя настройте на подключение к этому хранилищу.
